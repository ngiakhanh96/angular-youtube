import './polyfills.server.mjs';
import{Aa as xe,Ea as ye,Ha as we,Ja as be,ca as ce,ea as pe,ja as Y,ka as fe,la as S,na as ue,oa as ge,pa as ve,qa as Ie,ra as he,sa as _e,va as Pe,wa as Ce,xa as Se,y as de,z as me}from"./chunk-NMSYZPBT.mjs";import{$b as ie,Ab as Z,Bb as D,E as z,Fc as L,Ga as $,Ja as W,La as P,Ma as Q,Nb as ee,Ob as te,P as l,Pb as k,Ra as j,Sb as M,Tb as oe,U as T,V,Ya as q,Za as J,Zb as R,Zc as le,_a as K,_b as ne,ca as A,db as E,eb as B,fb as m,gb as u,hb as g,hc as re,i as w,ib as F,kd as se,l as b,m as N,ob as H,pb as O,rb as C,sb as c,u as G,uc as ae,va as U,xa as d,zb as X}from"./chunk-QK5EL6F6.mjs";import{a as s,b as _}from"./chunk-N7QBYMCK.mjs";var p=Ie({source:"HomePage",events:{loadYoutubePopularVideos:void 0,loadYoutubePopularVideosSuccess:void 0}});function Te(){return S({state:void 0},he((o,t=l(ve),e=l(ye),n=l(Pe))=>({loadYoutubePopularVideos$:Se(t,p.loadYoutubePopularVideos,i=>(i.payload.nextPage&&o.videos()&&!o.videos()?.nextPageToken?w(o.videos()):n.getPopularVideos(i.payload.itemPerPage,i.payload.videoCategory,i.payload.nextPage?o.videos()?.nextPageToken:void 0)).pipe(z(a=>N([n.getChannelsInfo(a.items.map(r=>r.snippet.channelId),i.payload.itemPerPage),...a.items.map(r=>e.getVideoInfo(r.id).pipe(G(v=>(console.error(v),w({videoId:r.id,formatStreams:[]})))))]).pipe(b(r=>{let[v,...I]=r;return[a,v,...I.filter(h=>h!=null)]}))),b(([a,r,...v])=>{let I={};r.items.forEach(f=>I[f.id]=f);let h={};return v.forEach(f=>{f.formatStreams.length>0?h[f.videoId]=f.formatStreams[0]:a.items=a.items.filter(Be=>Be.id!==f.videoId)}),p.loadYoutubePopularVideosSuccess({nextPage:i.payload.nextPage,videos:a,channelsInfo:I,videosInfo:h})})),!1)})))}var He={videos:void 0,channelsInfo:{},videosInfo:{}},x=fe(ue(He),Te(),Oe());function Oe(){return S({state:void 0},_e(ge(p.loadYoutubePopularVideosSuccess,({payload:{nextPage:o,videos:t,channelsInfo:e,videosInfo:n}},i)=>({videos:_(s({},t),{items:o?[...i.videos?.items??[],...t.items]:t.items}),channelsInfo:s(s({},i.channelsInfo),e),videosInfo:s(s({},i.videosInfo),n)}))))}var De=["gridItem"],ke=()=>[L],Ee=o=>({video:o}),Ve=(o,t)=>t.videoId;function Me(o,t){if(o&1){let e=O();u(0,"ay-video-player-card",8),C("selected",function(i){T(e);let a=c();return V(a.onSelect(i))}),g()}if(o&2){let e=t.video;c();let n=k(4);m("videoPlayerCardInfo",e)("channelInfoHeight",n)}}function Re(o,t){o&1&&H(0)}function Le(o,t){if(o&1&&P(0,Re,1,0,"ng-container",9),o&2){let e=c().$implicit;c();let n=D(6);m("ngTemplateOutlet",n)("ngTemplateOutletContext",M(2,Ee,e))}}function Ye(o,t){o&1&&H(0)}function Ne(o,t){if(o&1&&P(0,Ye,1,0,"ng-container",9),o&2){let e=c().$implicit,n=c(),i=D(6);m("ngTemplateOutlet",i)("ngTemplateOutletContext",M(2,Ee,n.convertToPlayerSkeletonItem(e)))}}function Ge(o,t){o&1&&(u(0,"div",7,1),Q(2,Le,1,4)(3,Ne,1,4),q(4,2,ke,null,3,null,null,2,j),K(),J(),g())}function ze(o,t){if(o&1&&(u(0,"div",7),F(1,"ay-video-player-card",10),g()),o&2){let e=t.$implicit;c();let n=k(4);d(),m("videoPlayerCardInfo",e)("channelInfoHeight",n)}}var y=class o extends xe{homePageStore=l(x);videos=ie({source:()=>({videosWithMetaData:this.homePageStore.videos(),channelsInfo:this.homePageStore.channelsInfo(),videosInfo:this.homePageStore.videosInfo()}),computation:(t,e)=>{let n=t.videosWithMetaData?.items??[],i=t.channelsInfo??{},a=t.videosInfo??{};return n.length===0?[...e?.value??Y.createPlayerSkeletonItems(20,"mainSkeleton")]:n.filter(r=>r.kind==="youtube#video").map(r=>({isSkeleton:!1,videoId:r.id,title:r.snippet.title,channelName:r.snippet.channelTitle,viewCount:+r.statistics.viewCount,publishedDate:new Date(r.snippet.publishedAt),duration:r.contentDetails.duration,channelLogoUrl:i[r.snippet.channelId]?.snippet.thumbnails.default.url??"",videoUrl:a[r.id]?.url??"",isVerified:!1}))??[]}});videosCategoriesViewModel=R(()=>this.sandbox.sharedStore.videoCategories()?.items.map(e=>({title:e.snippet.title,id:e.id}))??[]);numberOfSkeletonPlayerItemsToFillBottomLine=A(0);skeletonPlayerItemsToFillBottomLine=R(()=>Y.createPlayerSkeletonItems(this.numberOfSkeletonPlayerItemsToFillBottomLine(),"filledInSkeleton"));sidebarService=l(ce);playerItems=re("gridItem");router=l(se);titleService=l(le);loadingBarService=l(pe);constructor(){super(),this.titleService.setTitle("Angular Youtube"),this.dispatchEvent(p.loadYoutubePopularVideos({nextPage:!1,itemPerPage:20})),this.dispatchEvent(Ce.loadYoutubeVideoCategories()),ne(()=>{(this.videos()?.filter(e=>!e.isSkeleton)??[]).length>0&&this.loadingBarService.load(100)}),ae({read:()=>{this.videos(),this.resize()}})}ngOnInit(){this.sidebarService.setSelectedIconName("home"),this.loadingBarService.load(25)}onScrollDown(){this.dispatchEvent(p.loadYoutubePopularVideos({nextPage:!0,itemPerPage:20}))}onSelect(t){this.router.navigate(["watch"],{queryParams:{v:t}})}resize(){let t=this.playerItems(),e=this.calculateItemsPerLine(t);if(e>0){let n=this.videos().length%e,i=n===0?0:e-n;this.numberOfSkeletonPlayerItemsToFillBottomLine.set(i+2*e)}}calculateItemsPerLine(t){let e=0;if(t.length>0){let n=t[0].nativeElement.offsetTop;e++;for(let i=1;i<t.length&&t[i].nativeElement.offsetTop===n;i++)e++}return e}convertToPlayerSkeletonItem(t){return _(s({},t),{isSkeleton:!0})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=$({type:o,selectors:[["ay-browse"]],viewQuery:function(e,n){e&1&&X(n.playerItems,De,5),e&2&&Z()},hostBindings:function(e,n){e&1&&C("resize",function(){return n.resize()},U)},features:[W],decls:11,vars:6,consts:[["videoCard",""],["gridItem",""],[1e3],[1,"browse_container"],[1,"browse_video_categories",3,"ayFixedTop"],[3,"videoCategories","scrollingWidth"],["ayInfiniteScroll","",1,"browse_video_player_grid",3,"scrolled","infiniteScrollDistance","infiniteScrollThrottle"],[1,"browse_video_player"],[3,"selected","videoPlayerCardInfo","channelInfoHeight"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"videoPlayerCardInfo","channelInfoHeight"]],template:function(e,n){if(e&1){let i=O();u(0,"div",3)(1,"div",4),F(2,"ay-video-categories",5),g(),u(3,"div",6),C("scrolled",function(){return T(i),V(n.onScrollDown())}),ee(4),P(5,Me,1,2,"ng-template",null,0,oe),E(7,Ge,6,0,"div",7,Ve),E(9,ze,2,2,"div",7,Ve),g()()}e&2&&(d(),m("ayFixedTop",56),d(),m("videoCategories",n.videosCategoriesViewModel())("scrollingWidth",400),d(),m("infiniteScrollDistance",3)("infiniteScrollThrottle",50),d(),te("'20px'"),d(3),B(n.videos()),d(2),B(n.skeletonPlayerItemsToFillBottomLine()))},dependencies:[be,me,we,de,L],styles:["[_nghost-%COMP%]{position:relative;display:block;flex-direction:row}.browse_container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-left:24px}.browse_container[_ngcontent-%COMP%]   .browse_video_categories[_ngcontent-%COMP%]{padding-right:24px;padding-top:12px;padding-bottom:12px}.browse_container[_ngcontent-%COMP%]   .browse_video_player_grid[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;column-gap:6px;row-gap:34px;overflow:scroll;overflow-x:hidden;padding-top:24px}.browse_container[_ngcontent-%COMP%]   .browse_video_player_grid[_ngcontent-%COMP%]   .browse_video_player[_ngcontent-%COMP%]{flex-grow:1;flex-basis:374px}"],changeDetection:0})};var Ot=[{path:"",providers:[x],component:y,data:{detectRouteTransitions:!1}}];export{y as BrowseComponent,Ot as HOME_PAGE_ROUTES};
