<div class="player-container">
  @if (!disablePlaceholder() && !isVideoPlaying()) {
    <ay-youtube-player-placeholder
      [videoId]="videoId()"
      [borderRadius]="borderRadius()"
      [isLoading]="false"
      [buttonLabel]="'Play Video'"
      [quality]="placeholderImageQuality()"
      [showPlayButton]="showPlayButton()"
      [boxShadow]="boxShadow()"
      (click)="playVideo()"
    />
  }
  <div
    class="player"
    [style.display]="!isVideoPlaying() && !disablePlaceholder() ? 'none' : ''"
    #videoPlayerContainer
    (mouseover)="onMouseEnter()"
    (mouseleave)="onMouseLeave()"
  >
    <video
      preload="auto"
      #videoPlayer
      (click)="onVideoClick()"
      (ended)="onVideoEnded()"
      (loadedmetadata)="onLoadedMetadata()"
      (volumechange)="onVolumeChange()"
      (play)="onPlay()"
      (pause)="onPause()"
      (seeking)="onSeeking()"
      (timeupdate)="onTimeUpdate()"
      (seeked)="onSeeked()"
      (waiting)="onWaiting()"
      (playing)="onPlaying()"
      (canplay)="onCanPlay()"
      (canplaythrough)="onCanPlay()"
      (leavepictureinpicture)="onLeavePictureInPicture($event)"
    >
      <source [src]="videoUrl() ?? ''" type="video/mp4" />
    </video>
    <audio #audioPlayer [src]="audioUrl() ?? ''"></audio>
    <div class="player_bottom" [style.display]="playerButtonsDisplay()">
      <div
        class="player_bottom_progress-bar-container"
        (mousedown)="onProgressBarMouseDown($event)"
      >
        <div class="progress-bar" #progressBar>
          <div
            class="progress-bar-loaded"
            [style.width.%]="loadedProgress()"
          ></div>
          <div
            class="progress-bar-played"
            [style.width.%]="playedProgress()"
          ></div>
          <div
            class="progress-bar-handle"
            [style.left.%]="playedProgress()"
          ></div>
        </div>
      </div>
      <div
        class="player_bottom_buttons-container"
        (click)="onButtonsContainerClick()"
      >
        <div class="player_bottom_buttons-left">
          <div class="player_bottom_button" (click)="toggleVideo($event)">
            <ng-container
              *ngTemplateOutlet="
                button;
                context: {
                  viewBox: '8 8 20 20',
                  buttonIcon: playButtonIcon(),
                }
              "
            />
          </div>

          <div class="player_bottom_button" (click)="onNextVideo($event)">
            <ng-container
              *ngTemplateOutlet="
                button;
                context: {
                  viewBox: '8 8 20 20',
                  buttonIcon: 'next',
                }
              "
            />
          </div>

          <div
            class="player_bottom_button volume_container"
            (wheel)="onVolumeSliderWheel($event)"
            (mouseenter)="onVolumeContainerMouseEnter()"
            (mouseleave)="onVolumeContainerMouseLeave()"
          >
            <div class="volume_icon" (click)="toggleMute($event)">
              <ng-container
                *ngTemplateOutlet="
                  button;
                  context: {
                    viewBox: '6 6 24 24',
                    buttonIcon: muteButtonIcon(),
                  }
                "
              />
            </div>
            <div
              class="volume_slider_container"
              (mousedown)="onVolumeSliderMouseDown($event)"
              #volumeSlider
            >
              <div class="volume_slider"></div>
              <div class="volume_slider_level"></div>
              <div class="volume_slider_handle"></div>
            </div>
          </div>

          <div class="time-display">
            {{ currentTimeString() }} / {{ durationString() }}
          </div>
        </div>
        <div class="player_bottom_buttons-right">
          <div
            class="player_bottom_button mr-[14px]"
            (click)="toggleAutoNext()"
          >
            <div class="player_bottom_button--autonext">
              <div
                [class]="
                  autoNext()
                    ? 'player_bottom_button--autonext--enabled'
                    : 'player_bottom_button--autonext--disabled'
                "
              ></div>
            </div>
          </div>

          <div class="player_bottom_button">
            <ng-container
              *ngTemplateOutlet="
                button;
                context: {
                  viewBox: '8 8 20 20',
                  buttonIcon: 'subtitle',
                }
              "
            />
          </div>

          <div class="player_bottom_button">
            <ng-container
              *ngTemplateOutlet="
                button;
                context: {
                  viewBox: '8 8 20 20',
                  buttonIcon: 'player-settings',
                }
              "
            />
          </div>

          <div class="player_bottom_button" (click)="showMiniPlayer.emit()">
            <ng-container
              *ngTemplateOutlet="
                button;
                context: {
                  viewBox: '6 6 24 24',
                  buttonIcon: 'player-mini',
                }
              "
            />
          </div>

          @if (screenMode() === ScreenMode.Default) {
            <div class="player_bottom_button" (click)="toggleViewMode()">
              <ng-container
                *ngTemplateOutlet="
                  button;
                  context: {
                    viewBox: '8 8 20 20',
                    buttonIcon: viewModeIcon(),
                  }
                "
              />
            </div>
          }

          <div class="player_bottom_button" (click)="toggleScreenMode()">
            <ng-container
              *ngTemplateOutlet="
                button;
                context: {
                  viewBox: '8 8 20 20',
                  buttonIcon: playerScreenIcon(),
                }
              "
            />
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #button let-viewBox="viewBox" let-buttonIcon="buttonIcon">
  <ay-text-icon-button
    [svgIcon]="buttonIcon"
    color="var(--white-color)"
    backgroundColor="transparent"
    hoverBackgroundColor="transparent"
    borderRadius="0px"
    [disabledRipple]="true"
    [svgIconMarginLeft]="'0px'"
    [svgIconMarginRight]="'0px'"
    [iconPaddingLeft]="'0px'"
    [iconPaddingRight]="'0px'"
    [viewBox]="viewBox"
  />
</ng-template>
